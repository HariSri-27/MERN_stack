<!DOCTYPE html>
<html>
<head>
  <title>Student CRUD App</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #f4f6f9;
    }

    h2 {
      color: #333;
    }

    input, textarea {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }

    button {
      padding: 8px 15px;
      margin: 5px 5px 5px 0;
      border: none;
      cursor: pointer;
    }

    .primary { background: #007bff; color: white; }
    .success { background: #28a745; color: white; }
    .danger { background: #dc3545; color: white; }

    .card {
      background: white;
      padding: 15px;
      margin-top: 10px;
      border-radius: 6px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h2>Student CRUD Application</h2>

<button class="primary" onclick="fetchStudent()">Load Student</button>

<div class="card">
  <label>Student Name</label>
  <input type="text" id="student_name">

  <label>Grade</label>
  <input type="text" id="grade">

  <label>Academic Year</label>
  <input type="text" id="academic_year">
</div>

<h3>Subjects</h3>
<div id="subjectsContainer"></div>

<button class="success" onclick="addSubject()">Add Subject</button>
<button class="primary" onclick="updateStudent()">Update Student</button>
<button class="danger" onclick="deleteStudent()">Delete Student</button>

<script>
const API_URL = "http://localhost:3000/";

let subjects = [];

// READ
async function fetchStudent() {
  const response = await fetch(API_URL);
  const data = await response.json();

  document.getElementById("student_name").value = data.student_name;
  document.getElementById("grade").value = data.grade;
  document.getElementById("academic_year").value = data.academic_year;

  subjects = data.subjects;
  renderSubjects();
}

// RENDER SUBJECTS
function renderSubjects() {
  const container = document.getElementById("subjectsContainer");
  container.innerHTML = "";

  subjects.forEach((subject, index) => {
    container.innerHTML += `
      <div class="card">
        <label>Subject Name</label>
        <input type="text" value="${subject.subject_name}" 
          onchange="updateSubjectName(${index}, this.value)" />

        <label>Notes</label>
        <textarea onchange="updateSubjectNotes(${index}, this.value)">
${subject.notes}</textarea>

        <button class="danger" onclick="removeSubject(${index})">
          Delete Subject
        </button>
      </div>
    `;
  });
}

// CREATE SUBJECT
function addSubject() {
  const newSubject = {
    id: Date.now(),
    subject_name: "",
    notes: ""
  };
  subjects.push(newSubject);
  renderSubjects();
}

// UPDATE SUBJECT NAME
function updateSubjectName(index, value) {
  subjects[index].subject_name = value;
}

// UPDATE SUBJECT NOTES
function updateSubjectNotes(index, value) {
  subjects[index].notes = value;
}

// DELETE SUBJECT
function removeSubject(index) {
  subjects.splice(index, 1);
  renderSubjects();
}

// UPDATE STUDENT (PUT)
async function updateStudent() {
  const updatedData = {
    student_name: document.getElementById("student_name").value,
    grade: document.getElementById("grade").value,
    academic_year: document.getElementById("academic_year").value,
    subjects: subjects
  };

  await fetch(API_URL, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(updatedData)
  });

  alert("Student Updated Successfully!");
}

// DELETE STUDENT
async function deleteStudent() {
  await fetch(API_URL, {
    method: "DELETE"
  });

  alert("Student Deleted Successfully!");
  location.reload();
}
</script>

</body>
</html>